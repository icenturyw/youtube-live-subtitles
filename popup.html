<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube 字幕生成器</title>
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div class="container">
    <header>
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
          <rect x="2" y="4" width="20" height="16" rx="3" stroke="currentColor" stroke-width="2" />
          <path d="M6 14h4M12 14h6M6 18h8" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          <circle cx="12" cy="9" r="2" fill="currentColor" />
        </svg>
      </div>
      <h1>YouTube 字幕生成器</h1>
    </header>

    <main>
      <!-- 状态卡片 -->
      <div class="status-card" id="statusCard">
        <div class="status-indicator" id="statusIndicator"></div>
        <span class="status-text" id="statusText">检查服务状态...</span>
      </div>

      <!-- 进度条 -->
      <div class="progress-container" id="progressContainer" style="display: none;">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-info"
          style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 4px; color: var(--text-secondary);">
          <div class="progress-text" id="progressText">准备中...</div>
          <div id="progressPercentage">0%</div>
        </div>
      </div>

      <!-- 主控制按钮 -->
      <button class="main-btn" id="generateBtn">
        <span class="btn-icon">🎬</span>
        <span class="btn-text">生成字幕</span>
      </button>

      <button class="main-btn secondary-btn" id="batchBtn" style="display: none;">
        <span class="btn-icon">📚</span>
        <span class="btn-text">批量生成列表字幕</span>
      </button>

      <!-- 本地文件拖拽识别 -->
      <div class="drop-zone" id="dropZone">
        <div class="drop-zone-content">
          <span class="drop-icon">📁</span>
          <p class="drop-text">拖拽音视频文件到此处</p>
          <p class="drop-hint">或点击选择文件</p>
          <input type="file" id="fileInput" accept="audio/*,video/*" style="display: none;">
        </div>
        <div class="file-info" id="fileInfo" style="display: none;">
          <span id="fileName"></span>
          <span id="fileSize"></span>
        </div>
      </div>

      <!-- 字幕控制（生成后显示） -->
      <div class="subtitle-controls" id="subtitleControls" style="display: none;">
        <div class="toggle-container">
          <input type="checkbox" id="subtitleToggle" checked style="display: none;">
          <label for="subtitleToggle" class="control-btn active" id="toggleSubtitleLabel">
            <span>👁️</span> <span id="toggleText">字幕已开启</span>
          </label>
        </div>
        <button class="control-btn" id="downloadBtn">
          <span>💾</span> 下载 SRT
        </button>
        <button class="control-btn" id="clearCacheBtn"
          style="background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%);">
          <span>🔄</span> 清除缓存并重试
        </button>
      </div>

      <!-- 设置面板 -->
      <div class="settings-panel">
        <h3>⚙️ 设置</h3>

        <div class="setting-item">
          <label for="language">视频语言</label>
          <select id="language">
            <option value="zh">中文</option>
            <option value="en">English</option>
            <option value="ja">日本語</option>
            <option value="ko">한국어</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
            <option value="de">Deutsch</option>
            <option value="ru">Русский</option>
            <option value="auto">自动检测</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="domain">视频领域 (Prompt 引导)</label>
          <select id="domain">
            <option value="general">通用 / 自动</option>
            <option value="finance">金融交易 (均线/阻力位等)</option>
            <option value="programming">计算机编程 (异步/类/接口等)</option>
            <option value="medical">医学健康 (症状/诊断等)</option>
            <option value="gaming">游戏电竞 (副本/冷却等)</option>
          </select>
        </div>

        <div class="setting-item">
          <label for="engine">本地识别引擎</label>
          <select id="engine">
            <option value="whisper">Whisper (通用型)</option>
            <option value="sensevoice">SenseVoice (中文高精度/极速)</option>
          </select>
        </div>

        <div class="setting-item">
          <label class="switch-label" for="llmCorrection">🧠 LLM 纠错 (需本地 LM Studio)</label>
          <label class="switch">
            <input type="checkbox" id="llmCorrection">
            <span class="slider round"></span>
          </label>
          <p class="setting-hint" style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
            使用本地 LLM 修正识别中的错别字</p>
        </div>

        <div class="setting-item">
          <label for="whisperService">识别服务</label>
          <select id="whisperService">
            <option value="local">本地 / 远程 VPS (Faster-Whisper)</option>
            <option value="cloudflare">Cloudflare Workers AI</option>
            <option value="groq">Groq API (极速)</option>
            <option value="openai">OpenAI Whisper API</option>
            <option value="browser">浏览器内置 (需播放)</option>
          </select>
        </div>

        <div class="setting-item" id="serverHostSetting">
          <label for="serverHost">服务器地址</label>
          <input type="text" id="serverHost" placeholder="http://127.0.0.1:8765" value="http://127.0.0.1:8765">
          <p class="setting-hint" style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
            本地使用默认值，VPS则填入服务器 IP</p>
        </div>

        <div class="setting-item" id="authKeySetting">
          <label for="authKey">服务器鉴权 Key (X-API-Key)</label>
          <input type="password" id="authKey" placeholder="VPS 部署时必填">
        </div>

        <div class="setting-item api-key-setting" id="apiKeySetting" style="display: none;">
          <label for="apiKey" id="apiKeyLabel">API Key</label>
          <input type="password" id="apiKey" placeholder="输入 API Key">
        </div>

        <div class="style-section collapsible">
          <h4 class="collapsible-header" data-target="translateSettings">
            <span>🌍 翻译设置</span>
            <span class="collapse-icon">▼</span>
          </h4>
          <div class="collapsible-content collapsed" id="translateSettings">
            <div class="setting-item">
              <label class="switch-label" for="translateBilingual">启用双语字幕</label>
              <label class="switch">
                <input type="checkbox" id="translateBilingual">
                <span class="slider round"></span>
              </label>
            </div>
            <div class="setting-item">
              <label for="targetLanguage">目标语言</label>
              <select id="targetLanguage">
                <option value="zh">中文 (简体)</option>
                <option value="en">英文</option>
                <option value="ja">日文</option>
                <option value="ko">韩文</option>
                <option value="fr">法语</option>
                <option value="de">德语</option>
              </select>
            </div>
          </div>
        </div>

        <div class="setting-item">
          <label for="fontSize">字幕大小</label>
          <input type="range" id="fontSize" min="16" max="36" value="24">
          <span id="fontSizeValue">24px</span>
        </div>

        <div class="setting-item">
          <label for="position">字幕位置</label>
          <select id="position">
            <option value="bottom">底部</option>
            <option value="top">顶部</option>
          </select>
        </div>

        <!-- 高级样式设置 -->
        <div class="style-section collapsible">
          <h4 class="collapsible-header" data-target="advancedStyles">
            <span>🎨 高级样式</span>
            <span class="collapse-icon">▼</span>
          </h4>
          <div class="collapsible-content collapsed" id="advancedStyles">
            <div class="setting-item">
              <label for="subtitleColor">字幕颜色</label>
              <input type="color" id="subtitleColor" value="#ffffff">
            </div>

            <div class="setting-item">
              <label for="bgColor">背景颜色</label>
              <input type="color" id="bgColor" value="#000000">
            </div>

            <div class="setting-item">
              <label for="bgOpacity">背景透明度</label>
              <input type="range" id="bgOpacity" min="0" max="100" value="80">
              <span id="bgOpacityValue">80%</span>
            </div>

            <div class="setting-item">
              <label for="fontFamily">字体</label>
              <select id="fontFamily">
                <option value="Arial, sans-serif">Arial</option>
                <option value="'Microsoft YaHei', sans-serif">微软雅黑</option>
                <option value="'SimHei', sans-serif">黑体</option>
                <option value="'SimSun', serif">宋体</option>
                <option value="'KaiTi', serif">楷体</option>
                <option value="'Courier New', monospace">Courier New</option>
              </select>
            </div>

            <div class="setting-item">
              <label for="strokeWidth">描边宽度</label>
              <input type="range" id="strokeWidth" min="0" max="4" value="2" step="0.5">
              <span id="strokeWidthValue">2px</span>
            </div>

            <div class="setting-item">
              <label for="strokeColor">描边颜色</label>
              <input type="color" id="strokeColor" value="#000000">
            </div>
          </div>
        </div>

        <button class="save-settings-btn" id="saveSettingsBtn">
          <span>💾</span> 保存配置信息
        </button>
      </div>

      <!-- 提示信息 -->
      <div class="tips">
        <p>💡 <strong>使用本地 Whisper 服务：</strong></p>
        <p>1. 运行 <code>whisper-server/start.bat</code></p>
        <p>2. 等待服务启动后点击"生成字幕"</p>
        <p>3. 自动下载音频并识别，无需播放视频</p>
      </div>
    </main>

    <footer>
      <p>Made with ❤️ for better accessibility</p>
    </footer>
  </div>

  <script src="popup.js"></script>
</body>

</html>